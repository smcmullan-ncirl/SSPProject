version: "3.5"
services:
    zookeeper:
        image: wurstmeister/zookeeper

    kafka:
        image: wurstmeister/kafka
        depends_on:
            - zookeeper
        ports:
            - "9092:9092"
        environment:
            KAFKA_ADVERTISED_HOST_NAME: kafka
            KAFKA_ZOOKEEPER_CONNECT: zookeeper:2181

    postgres:
        image: postgres
        ports:
            - "5432:5432"
        environment:
            POSTGRES_DB: sspdb
            POSTGRES_USER: sspuser
            POSTGRES_PASSWORD: ssppassword
            POSTGRES_DATA: /var/lib/postgresql/data/pgdata
        volumes:
            - "postgres:/var/lib/postgresql/data"

    spark-master:
        image: bitnami/spark
        depends_on:
            - kafka
            - postgres
        hostname: spark-master
        environment:
            - SPARK_MODE=master
            - SPARK_RPC_AUTHENTICATION_ENABLED=no
            - SPARK_RPC_ENCRYPTION_ENABLED=no
            - SPARK_LOCAL_STORAGE_ENCRYPTION_ENABLED=no
            - SPARK_SSL_ENABLED=no
            - SPARK_PUBLIC_DNS=localhost
        ports:
            - "7077:7077"
            - "8080:8080"

    spark-worker:
        image: bitnami/spark
        depends_on:
            - spark-master
        hostname: spark-worker
        environment:
            - SPARK_MODE=worker
            - SPARK_MASTER_URL=spark://spark-master:7077
            - SPARK_WORKER_MEMORY=2G
            - SPARK_WORKER_CORES=2
            - SPARK_RPC_AUTHENTICATION_ENABLED=no
            - SPARK_RPC_ENCRYPTION_ENABLED=no
            - SPARK_LOCAL_STORAGE_ENCRYPTION_ENABLED=no
            - SPARK_SSL_ENABLED=no
            - SPARK_PUBLIC_DNS=localhost
        ports:
            - "4040:4040"
            - "8081:8081"

#    flink-jobmanager:
#        image: flink
#        depends_on:
#            - kafka
#            - postgres
#        hostname: flink-jobmanager
#        expose:
#            - "6123"
#        ports:
#            - "8081:8081"
#        command: jobmanager
#        environment:
#            - JOB_MANAGER_RPC_ADDRESS=flink-jobmanager
#
#    flink-taskmanager:
#        image: flink
#        depends_on:
#            - flink-jobmanager
#        hostname: flink-taskmanager
#        expose:
#            - "6121"
#            - "6122"
#        command: taskmanager
#        links:
#            - "flink-jobmanager:jobmanager"
#        environment:
#            - JOB_MANAGER_RPC_ADDRESS=flink-jobmanager

volumes:
  postgres:
